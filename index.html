<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–Ω–µ–≤–Ω–∏–∫ –ü–∏—Ç–∞–Ω–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #1c1c1d; --card-bg: #2c2c2e; --text-color: #ffffff;
            --hint-color: #8e8e93; --accent-color: #0a84ff; --border-color: #3a3a3c;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; }
        .nav-tabs { display: flex; background: var(--card-bg); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border-color); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: var(--hint-color); font-size: 13px; font-weight: bold; cursor: pointer; }
        .tab-btn.active { color: var(--accent-color); border-bottom: 3px solid var(--accent-color); }
        .container { padding: 10px; padding-bottom: 120px; }
        .section { display: none; }
        .section.active { display: block; }
        .meal-card { background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .meal-title { font-size: 1.1rem; font-weight: bold; color: var(--accent-color); margin-bottom: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }
        .group-header { font-size: 0.8rem; color: var(--hint-color); margin: 15px 0 8px; font-weight: bold; }
        .product-item {
            display: flex; justify-content: space-between; align-items: center; padding: 12px; 
            border: 1px solid var(--border-color); border-radius: 10px; background: var(--bg-color); 
            margin-bottom: 6px; transition: 0.2s; -webkit-tap-highlight-color: transparent;
        }
        .status-half { background: #ffd60a !important; color: #000; font-weight: bold; border-color: #ffd60a; }
        .status-full { background: #32d74b !important; color: #000; font-weight: bold; border-color: #32d74b; }
        input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border-color); background: var(--bg-color); color: #fff; margin-top: 5px; box-sizing: border-box; font-size: 16px; }
        label { display: block; margin-top: 10px; color: var(--hint-color); font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="tab-btn active" id="btn-nutrition" onclick="showSection('nutrition')">–ü–∏—Ç–∞–Ω–∏–µ</button>
    <button class="tab-btn" id="btn-activity" onclick="showSection('activity')">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
    <button class="tab-btn" id="btn-measurements" onclick="showSection('measurements')">–ó–∞–º–µ—Ä—ã</button>
</div>

<div class="container">
    <div id="nutrition" class="section active"><div id="food-app"></div></div>
    <div id="activity" class="section">
        <div class="meal-card"><div class="meal-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div><label>–®–∞–≥–∏</label><input type="number" id="steps"></div>
    </div>
    <div id="measurements" class="section">
        <div class="meal-card">
            <div class="meal-title">–ó–∞–º–µ—Ä—ã</div>
            <label>–í–µ—Å (–∫–≥)</label><input type="number" id="m_weight" step="0.1">
            <label>–ì—Ä—É–¥—å (—Å–º)</label><input type="number" id="m_chest">
            <label>–¢–∞–ª–∏—è (—Å–º)</label><input type="number" id="m_waist">
            <label>–ë–µ–¥—Ä–∞ (—Å–º)</label><input type="number" id="m_hips">
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.text = "–û–¢–ü–†–ê–í–ò–¢–¨ –û–¢–ß–ï–¢";
    tg.MainButton.show();

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('btn-' + id).classList.add('active');
    }

    const dietData = [
        {
            name: "1Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "1–∞", title: "–∞) –°–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã (~145 –∫–∫–∞–ª)", items: [{n:"–ë–æ–±–æ–≤—ã–µ",w:40},{n:"–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å",w:140},{n:"–ö—É–∫—É—Ä—É–∑–∞ —Å–≤–µ–∂–∞—è",w:140},{n:"–†–∏—Å (–Ω–µ —à–ª–∏—Ñ.)",w:40},{n:"–ö—Ä—É–ø–∞ –ª—é–±–∞—è",w:40},{n:"–¶/–∑ –º—É–∫–∞",w:40},{n:"–•–ª–µ–±—Ü—ã",w:60},{n:"–¶/–∑ —Ö–ª–µ–±",w:65},{n:"–ú–∞–∫–∞—Ä–æ–Ω—ã —Ç–≤.",w:40},{n:"–õ–∞–≤–∞—à",w:60}] },
                { id: "1–±", title: "–±) –ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (~120 –∫–∫–∞–ª)", items: [{n:"–¢–≤–æ—Ä–æ–≥ 0.2%",w:160},{n:"–°—ã—Ä—ã",w:30},{n:"–°–º–µ—Ç–∞–Ω–∞ 15%",w:65},{n:"–ö–µ—Ñ–∏—Ä 1%",w:270},{n:"–ô–æ–≥—É—Ä—Ç 1%",w:250},{n:"–ú–æ–ª–æ–∫–æ 1%",w:280}] },
                { id: "1–≤", title: "–≤) –ß—Ç–æ —É–≥–æ–¥–Ω–æ (~500 –∫–∫–∞–ª)", items: [{n:"–ß—Ç–æ —É–≥–æ–¥–Ω–æ/–°–Ω–µ–∫–∏",w:100},{n:"–§—Ä—É–∫—Ç—ã",w:1000},{n:"–ë–∞–Ω–∞–Ω—ã",w:600}] }
            ]
        },
        {
            name: "2Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "2–≥", title: "–≥) –°–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã (~145 –∫–∫–∞–ª)", items: [{n:"–ë–æ–±–æ–≤—ã–µ",w:40},{n:"–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å",w:140},{n:"–ö—É–∫—É—Ä—É–∑–∞ —Å–≤–µ–∂–∞—è",w:140},{n:"–†–∏—Å (–Ω–µ —à–ª–∏—Ñ.)",w:40},{n:"–ö—Ä—É–ø–∞ –ª—é–±–∞—è",w:40},{n:"–¶/–∑ –º—É–∫–∞",w:40},{n:"–•–ª–µ–±—Ü—ã",w:60},{n:"–¶/–∑ —Ö–ª–µ–±",w:65},{n:"–ú–∞–∫–∞—Ä–æ–Ω—ã —Ç–≤.",w:40},{n:"–õ–∞–≤–∞—à",w:60}] },
                { id: "2–¥", title: "–¥) –ë–µ–ª–∫–∏ (~195 –∫–∫–∞–ª)", items: [{n:"–¢–µ–ª—è—Ç–∏–Ω–∞",w:165},{n:"–ü–µ—á–µ–Ω—å",w:165},{n:"–§–∏–ª–µ –ø—Ç–∏—Ü—ã",w:175},{n:"–†—ã–±–∞ –¥–æ 5%",w:175},{n:"–†—ã–±–∞ –æ—Ç 5%",w:140},{n:"2 —è–π—Ü–∞",w:1},{n:"–ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã",w:220}] },
                { id: "2–µ", title: "–µ) –û–≤–æ—â–∏ / –ì—Ä–∏–±—ã (~60 –∫–∫–∞–ª)", items: [{n:"–û–≤–æ—â–∏/–ó–µ–ª–µ–Ω—å",w:300},{n:"–ì—Ä–∏–±—ã",w:300}] },
                { id: "2—ë", title: "—ë) –ñ–∏—Ä—ã / –°–æ—É—Å—ã (~90 –∫–∫–∞–ª)", items: [{n:"–ú–∞—Å–ª–æ",w:10},{n:"–ú–∞–π–æ–Ω–µ–∑",w:13},{n:"–ê–≤–æ–∫–∞–¥–æ",w:55},{n:"–û–ª–∏–≤–∫–∏",w:70},{n:"–ì–æ—Ä—á–∏—Ü–∞",w:24},{n:"–ö–µ—Ç—á—É–ø",w:36},{n:"–°–∞–ª–æ",w:9}] }
            ]
        },
        {
            name: "3Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "3–∂", title: "–∂) –ú–æ–ª–æ—á–Ω—ã–µ (~130 –∫–∫–∞–ª)", items: [{n:"–¢–≤–æ—Ä–æ–≥ 0.2%",w:190},{n:"–°—ã—Ä—ã",w:40},{n:"–°–º–µ—Ç–∞–Ω–∞ 15%",w:75},{n:"–ö–µ—Ñ–∏—Ä 1%",w:330},{n:"–ô–æ–≥—É—Ä—Ç 1%",w:330},{n:"–ú–æ–ª–æ–∫–æ 1%",w:335}] },
                { id: "3–∑", title: "–∑) –§—Ä—É–∫—Ç—ã –∏ —è–≥–æ–¥—ã (~230 –∫–∫–∞–ª)", items: [{n:"–§—Ä—É–∫—Ç—ã/–Ø–≥–æ–¥—ã",w:320},{n:"–ë–∞–Ω–∞–Ω/–í–∏–Ω–æ–≥—Ä–∞–¥",w:190}] },
                { id: "3–∏", title: "–∏) –û—Ä–µ—Ö–∏ / –°–µ–º–µ–Ω–∞ (~110 –∫–∫–∞–ª)", items: [{n:"–û—Ä–µ—Ö–∏/–°–µ–º–µ–Ω–∞",w:15}] }
            ]
        },
        {
            name: "4Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "4–∏", title: "–∏) –ë–µ–ª–∫–∏ (~195 –∫–∫–∞–ª)", items: [{n:"–¢–µ–ª—è—Ç–∏–Ω–∞",w:165},{n:"–ü–µ—á–µ–Ω—å",w:165},{n:"–§–∏–ª–µ –ø—Ç–∏—Ü—ã",w:175},{n:"–†—ã–±–∞ –¥–æ 5%",w:175},{n:"–†—ã–±–∞ –æ—Ç 5%",w:140},{n:"2 —è–π—Ü–∞",w:1},{n:"–ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã",w:220}] },
                { id: "4–π", title: "–π) –û–≤–æ—â–∏ / –ì—Ä–∏–±—ã (~60 –∫–∫–∞–ª)", items: [{n:"–û–≤–æ—â–∏/–ó–µ–ª–µ–Ω—å",w:300},{n:"–ì—Ä–∏–±—ã",w:300}] },
                { id: "4–∫", title: "–∫) –ñ–∏—Ä—ã / –°–æ—É—Å—ã (~90 –∫–∫–∞–ª)", items: [{n:"–ú–∞—Å–ª–æ",w:10},{n:"–ú–∞–π–æ–Ω–µ–∑",w:13},{n:"–ê–≤–æ–∫–∞–¥–æ",w:55},{n:"–û–ª–∏–≤–∫–∏",w:70},{n:"–ì–æ—Ä—á–∏—Ü–∞",w:24},{n:"–ö–µ—Ç—á—É–ø",w:36},{n:"–°–∞–ª–æ",w:9}] }
            ]
        }
    ];

    let eaten = JSON.parse(localStorage.getItem('eaten_vFinal')) || {};

    function eat(groupId, itemName) {
        const key = groupId + "_" + itemName;
        let groupTotal = 0;
        for (let k in eaten) { if (k.startsWith(groupId + "_") && k !== key) groupTotal += eaten[k]; }

        const cur = eaten[key] || 0;
        let next = 0;

        if (cur === 0) { if (groupTotal + 0.5 <= 1) next = 0.5; else return; }
        else if (cur === 0.5) { if (groupTotal + 1 <= 1) next = 1; else next = 0; }
        else { next = 0; }

        if (next === 0) delete eaten[key]; else eaten[key] = next;
        localStorage.setItem('eaten_vFinal', JSON.stringify(eaten));
        renderFood();
    }

    function renderFood() {
        const app = document.getElementById('food-app');
        let html = '';
        dietData.forEach(meal => {
            html += `<div class="meal-card"><div class="meal-title">${meal.name}</div>`;
            meal.groups.forEach(g => {
                html += `<div class="group-header"><span>${g.title}</span></div><div style="display:flex;flex-direction:column;gap:5px;">`;
                g.items.forEach(i => {
                    const val = eaten[g.id + "_" + i.n] || 0;
                    const cls = val === 0.5 ? 'status-half' : (val === 1 ? 'status-full' : '');
                    const label = val > 0 ? (val === 0.5 ? '¬Ω –ø–æ—Ä—Ü.' : '1 –ø–æ—Ä—Ü.') : (i.w === 1 ? '' : i.w + '–≥');
                    html += `<div class="product-item ${cls}" onclick="eat('${g.id}', '${i.n}')"><span>${i.n}</span><span>${label}</span></div>`;
                });
                html += `</div>`;
            });
            html += `</div>`;
        });
        app.innerHTML = html;
    }

    const inputs = ['steps', 'm_weight', 'm_chest', 'm_waist', 'm_hips'];
    inputs.forEach(id => {
        const el = document.getElementById(id);
        el.value = localStorage.getItem(id) || "";
        el.oninput = () => localStorage.setItem(id, el.value);
    });

    tg.MainButton.onClick(() => {
        let report = `üìä *–û–¢–ß–ï–¢ –ó–ê ${new Date().toLocaleDateString('ru-RU')}*\n\n`;
        report += `üë£ –®–∞–≥–∏: ${document.getElementById('steps').value || 0}\n‚öñÔ∏è –í–µ—Å: ${document.getElementById('m_weight').value || '-'} –∫–≥\n`;
        
        let foodStr = "\nüçé *–ï–î–ê:*";
        dietData.forEach(m => {
            m.groups.forEach(g => {
                g.items.forEach(i => {
                    const v = eaten[g.id + "_" + i.n] || 0;
                    if(v > 0) foodStr += `\n‚Ä¢ ${i.n} (${v} –ø–æ—Ä—Ü.)`;
                });
            });
        });
        
        tg.sendData(report + foodStr);
        localStorage.clear();
    });

    renderFood();
</script>
</body>
</html>
