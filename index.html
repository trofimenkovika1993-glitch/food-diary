<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #1c1c1d;
            --card-bg: #2c2c2e;
            --text-color: #ffffff;
            --hint-color: #8e8e93;
            --accent-color: #0a84ff;
            --border-color: #3a3a3c;
        }

        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; padding: 0; 
            font-size: 17px;
        }

        .nav-tabs {
            display: flex;
            background: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }
        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            color: var(--hint-color);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        .tab-btn.active {
            color: var(--accent-color);
            border-bottom: 3px solid var(--accent-color);
        }

        .container { padding: 15px; padding-bottom: 80px; }
        .section { display: none; }
        .section.active { display: block; }

        .meal-card { background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .meal-title { font-size: 1.2rem; font-weight: bold; color: var(--accent-color); margin-bottom: 10px; }
        
        .group-header { font-size: 0.9rem; color: var(--hint-color); margin: 10px 0 5px 0; }
        .products-list { display: flex; flex-direction: column; gap: 8px; }
        
        .product-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; border: 1px solid var(--border-color);
            border-radius: 10px; background: var(--bg-color);
        }
        .status-half { background: #ffd60a !important; color: #000; font-weight: bold; }
        .status-full { background: #32d74b !important; color: #000; font-weight: bold; }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: var(--hint-color); font-size: 0.9rem; }
        input {
            width: 100%; padding: 12px; border-radius: 10px; 
            border: 1px solid var(--border-color); background: var(--bg-color);
            color: #fff; font-size: 16px; box-sizing: border-box;
        }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="showSection('nutrition')">–ü–∏—Ç–∞–Ω–∏–µ</button>
    <button class="tab-btn" onclick="showSection('activity')">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
    <button class="tab-btn" onclick="showSection('measurements')">–ó–∞–º–µ—Ä—ã</button>
</div>

<div class="container">
    <div id="nutrition" class="section active">
        <div id="food-app"></div>
    </div>

    <div id="activity" class="section">
        <div class="meal-card">
            <div class="meal-title">–®–∞–≥–∏</div>
            <input type="number" id="steps" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤...">
        </div>
    </div>

    <div id="measurements" class="section">
        <div class="meal-card">
            <div class="meal-title">–ó–∞–º–µ—Ä—ã</div>
            <div class="input-group"><label>–í–µ—Å (–∫–≥)</label><input type="number" step="0.1" id="m_weight"></div>
            <div class="input-group"><label>–ì—Ä—É–¥—å (—Å–º)</label><input type="number" id="m_chest"></div>
            <div class="input-group"><label>–¢–∞–ª–∏—è (—Å–º)</label><input type="number" id="m_waist"></div>
            <div class="input-group"><label>–ë–µ–¥—Ä–∞ (—Å–º)</label><input type="number" id="m_hips"></div>
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.text = "–û–¢–ü–†–ê–í–ò–¢–¨ –û–¢–ß–ï–¢";
    tg.MainButton.show();

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –ü–†–û–î–£–ö–¢–û–í –° –ö–ê–õ–û–†–ò–Ø–ú–ò (–Ω–∞ 100–≥)
    const dietData = [
        {
            name: "1Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "1–∞", title: "üìå –°–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã", items: [{ n: "–ë–æ–±–æ–≤—ã–µ", w: 40, c: 130 }, { n: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å", w: 140, c: 80 }, { n: "–†–∏—Å", w: 40, c: 340 }, { n: "–•–ª–µ–±—Ü—ã", w: 60, c: 300 }] },
                { id: "1–±", title: "üìå –ú–æ–ª–æ—á–Ω—ã–µ", items: [{ n: "–¢–≤–æ—Ä–æ–≥", w: 160, c: 80 }, { n: "–°—ã—Ä", w: 30, c: 350 }, { n: "–ö–µ—Ñ–∏—Ä", w: 270, c: 40 }] }
            ]
        },
        {
            name: "2Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "2–≥", title: "üìå –£–≥–ª–µ–≤–æ–¥—ã", items: [{ n: "–ì—Ä–µ—á–∫–∞", w: 40, c: 330 }, { n: "–ú–∞–∫–∞—Ä–æ–Ω—ã", w: 40, c: 350 }] },
                { id: "2–¥", title: "üìå –ë–µ–ª–∫–∏", items: [{ n: "–§–∏–ª–µ", w: 175, c: 110 }, { n: "–†—ã–±–∞", w: 175, c: 90 }, { n: "–Ø–π—Ü–∞ (2—à—Ç)", w: 1, c: 150 }] }
            ]
        },
        {
            name: "3Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "3–∂", title: "üìå –ú–æ–ª–æ—á–Ω—ã–µ", items: [{ n: "–ô–æ–≥—É—Ä—Ç", w: 330, c: 50 }, { n: "–¢–≤–æ—Ä–æ–≥", w: 190, c: 80 }] },
                { id: "3–∑", title: "üìå –§—Ä—É–∫—Ç—ã", items: [{ n: "–Ø–±–ª–æ–∫–æ", w: 320, c: 50 }, { n: "–ë–∞–Ω–∞–Ω", w: 190, c: 90 }] }
            ]
        },
        {
            name: "4Ô∏è‚É£ –ü—Ä–∏–µ–º –ø–∏—â–∏",
            groups: [
                { id: "4–∏", title: "üìå –ë–µ–ª–∫–∏", items: [{ n: "–¢–µ–ª—è—Ç–∏–Ω–∞", w: 165, c: 150 }, { n: "–ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã", w: 220, c: 80 }] },
                { id: "4–π", title: "üìå –û–≤–æ—â–∏", items: [{ n: "–û–≤–æ—â–∏", w: 300, c: 30 }] }
            ]
        }
    ];

    let eaten = {};

    function eat(groupId, itemName) {
        const key = `${groupId}_${itemName}`;
        const current = eaten[key] || 0;
        eaten[key] = current === 0 ? 0.5 : (current === 0.5 ? 1 : 0);
        renderFood();
    }

    function renderFood() {
        const container = document.getElementById('food-app');
        let html = '';
        dietData.forEach(meal => {
            html += `<div class="meal-card"><div class="meal-title">${meal.name}</div>`;
            meal.groups.forEach(group => {
                html += `<div class="group-header">${group.title}</div><div class="products-list">`;
                group.items.forEach(item => {
                    const key = `${group.id}_${item.n}`;
                    const val = eaten[key] || 0;
                    const cls = val === 0.5 ? 'status-half' : (val === 1 ? 'status-full' : '');
                    const label = val > 0 ? (val === 0.5 ? '¬Ω –ø–æ—Ä—Ü.' : '1 –ø–æ—Ä—Ü.') : item.w + (item.w > 5 ? '–≥' : '—à—Ç');
                    html += `<div class="product-item ${cls}" onclick="eat('${group.id}', '${item.n}')">
                        <span>${item.n}</span><span>${label}</span>
                    </div>`;
                });
                html += `</div>`;
            });
            html += `</div>`;
        });
        container.innerHTML = html;
    }

    tg.MainButton.onClick(() => {
        const steps = document.getElementById('steps').value || 0;
        const weight = document.getElementById('m_weight').value || "-";
        const date = new Date().toLocaleDateString('ru-RU');
        
        let report = `üìÖ –î–∞—Ç–∞: ${date}\nüë£ –®–∞–≥–∏: ${steps}\n‚öñÔ∏è –í–µ—Å: ${weight} –∫–≥\n\nüçé –°—ä–µ–¥–µ–Ω–æ:`;
        let totalCal = 0;

        dietData.forEach(meal => {
            meal.groups.forEach(group => {
                group.items.forEach(item => {
                    const val = eaten[`${group.id}_${item.n}`] || 0;
                    if (val > 0) {
                        const calories = item.w > 5 ? Math.round((item.c * item.w * val) / 100) : Math.round(item.c * val);
                        totalCal += calories;
                        report += `\n- ${item.n}: ${val} –ø–æ—Ä—Ü. (~${calories} –∫–∫–∞–ª)`;
                    }
                });
            });
        });

        report += `\n\nüî• –í—Å–µ–≥–æ –∑–∞ –¥–µ–Ω—å: ${totalCal} –∫–∫–∞–ª`;
        tg.sendData(report);
    });

    renderFood();
</script>
</body>
</html>
